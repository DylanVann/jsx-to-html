<html>
  <head>
    <title>JSX to HTML</title>
    <meta
      name="description"
      content="An online tool to make a best effort conversion of JSX to code that's usable in other frameworks."
    />
    <meta
      name="viewport"
      content="width=device-width,initial-scale=1,shrink-to-fit=no"
    />
    <style>
      * {
        box-sizing: border-box;
      }

      body {
        font-family: sans-serif;
        font-size: 18px;
      }

      html {
        height: 100%;
      }

      .row {
        width: 100%;
        display: grid;
        grid-template-columns: 1fr 6ch min-content 6ch 1fr;
      }

      .row > div:nth-child(2) {
        text-align: right;
      }

      .row > div:nth-child(4) {
        text-align: left;
      }

      .info {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 22px;
        height: 22px;
        border: 1px solid black;
        padding-bottom: 4px;
        border-radius: 50%;
      }
    </style>
    <link
      rel="stylesheet"
      href="https://unpkg.com/tailwindcss@1.7.5/dist/base.min.css"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/@tailwindcss/typography@0.2.0/dist/typography.min.css"
    />
  </head>
  <body>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script type="module">
      import {
        h,
        render,
        useState,
        useMemo,
      } from 'https://npm.reversehttp.com/preact,preact/hooks'
      import htm from 'https://unpkg.com/htm?module'
      import ow from 'https://unpkg.com/oceanwind'

      const { transform, registerPlugin } = window.Babel

      const html = htm.bind(h)

      document.body.className = ow`h-full flex flex-col divide-y divide-gray-400 items-center`

      function HeaderAndInfo() {
        const [showInfo, setShowInfo] = useState(false)
        return html`
          <div class=${`row ${ow`p-3 px-4`}`}>
            <div />
            <div>JSX</div>
            <div>→</div>
            <div>HTML</div>
            <div class=${ow`text-right flex flex-row items-center`}>
              <button class=${`info ${ow`focus:outline-none`}`} onClick=${() =>
          setShowInfo((v) => !v)}>ℹ</div>
              <div class=${ow`flex-1`}>
              Created by <a class=${ow`text-blue-500`} href="https://twitter.com/atomarranger" target="_blank"
                  rel="noopener">
                  @atomarranger
                  </a>
              </div>
            </div>
          </div>
          ${
            showInfo &&
            html`<div class=${ow`w-full p-3 px-4`}>
              <div class=${`prose ${ow`mx-auto`}`}>
                You may wish to use this if you're moving code over from React
                to another framework that does not use${' '}
                <code>camelCase</code> attributes, e.g. Svelte or Vue.
                <br />
                <br />
                The name of this is not exactly accurate. It will process any JS
                code you give it and convert JSX prop names to their DOM
                equivalents (e.g. <code>className</code> => <code>class</code>).
                You'll likely still need to cleanup some things and make some
                changes after using this.
                <br />
                <br />
                <strong>This tool does not:</strong>
                <ul>
                  <li>
                    Convert React (JS) code to other languages. It really just
                    converts the prop names.
                  </li>
                  <li>
                    Expand self closing tags, since other frameworks
                    (Svelte/Vue) also support self closing tags.
                  </li>
                  <li>
                    Handle all edge cases in prop names. I can't think of
                    anything it doesn't handle, but I'm not claiming it's
                    comprehensive.
                  </li>
                </ul>
                <a
                  href="https://github.com/DylanVann/jsx-to-html"
                  target="_blank"
                  rel="noopener"
                >
                  Source code is on GitHub.
                </a>
              </div>
            </div>`
          }
          `
      }

      const kebabCase = (string) =>
        string.replace(/([a-z0-9]|(?=[A-Z]))([A-Z])/g, '$1-$2').toLowerCase()

      const convertPropName = (propName) => {
        if (propName === 'className') {
          return 'class'
        }
        if (propName.startsWith('on')) {
          return propName
        }
        return kebabCase(propName)
      }

      function babelPluginJSXToHTML(babel) {
        const { types: t } = babel
        return {
          name: 'babel-plugin-jsx-to-html',
          visitor: {
            JSXAttribute(path) {
              path.node.name.name = convertPropName(path.node.name.name)
            },
          },
        }
      }

      registerPlugin('babel-plugin-jsx-to-html', babelPluginJSXToHTML)

      function Input(props) {
        return html`
          <textarea
            autocomplete="off"
            autocorrect="off"
            autocapitalize="off"
            spellcheck=${false}
            class=${ow`flex-1 p-3 px-4 focus:outline-none`}
            ...${props}
          />
        `
      }

      function EditorAndResult() {
        const [value, setValue] = useState('<div className="my-class" />')
        const onChange = (e) => setValue(e.target.value)
        const code = useMemo(() => {
          let code
          try {
            const result = transform(value, {
              plugins: ['syntax-jsx', 'babel-plugin-jsx-to-html'],
              compact: false,
              minified: false,
            })
            code = result.code.replace(/(^;)|(;$)/g, '')
          } catch (e) {}
          return code
        }, [value])
        return html`
          <div
            class=${ow`flex flex-row w-full flex-1 divide-x divide-gray-400`}
          >
            <${Input} onInput=${onChange} value=${value} />
            <${Input} value=${code} />
          </div>
        `
      }

      function App() {
        return html`
          <${HeaderAndInfo} />
          <${EditorAndResult} />
        `
      }

      render(html`<${App} />`, document.body)
    </script>
  </body>
</html>
